# 脚手架命令注册和执行过程开发

## 脚手架命令注册

## 第三章 高性能脚手架架构设计和缓存结构设计

## 第四章 通用npm 模块类 Package封装

### 脚手架命令本地调试功能支持

根据第三章设计好的架构设计图来进行改造，先将脚手架启动阶段要做的一系列事情封装到一个函数内，这里我们命名为prepare。

```javascript
// 准备阶段
async function prepare() {
    // 检查包的版本号
    checkPkgVersion()
    // 检查root启动
    checkRoot()
    // 检查用户主目录
    checkUserHome()
    // 检查环境变量
    checkEnv()
    // 检查cli是否最新版本
    await checkGlobalUpdate()
}
```

通过监听targetPath这个option，我们可以将program.tatgetPath这个值保存到环境变量上，这样就可以很轻松的在其他模块内取到这个值。

```javascript
// 指定targetPath
program.on('option:targetPath', function () {
    // 保存到process.env对象上 可以在其他模块中拿到
    process.env.CLI_TARGET_PATH = program.targetPath
})
```

## 补充：在自己电脑上如何配置多个公钥
